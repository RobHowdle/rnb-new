<section class="home-grid-section">
    <div class="res--140">
        <div class="inner-wrapper--1680">
            <div class="audio-container">
                <h1 class="blue-ds pb-1 text-center">Audio</h1>
                <p class="text-center">In the mood for some music? Try our custom music player!</p>
                <div class="audio-grid mt-2">
                    <div class="player">
                        <div class="controls autoplay">
                            <div class="buttons">
                                <img src="media/img/stop.png" id="stopBtn">
                                <img src="media/img/prev.png" id="prevBtn">
                                <img src="media/img/next.png" id="nextBtn">
                                <img src="media/img/play.png" id="playBtn">
                            </div>
                        </div>
                        <audio id="audioPlayer"></audio>
                        <div class="record-player">
                            <img src="media/img/record-player.png">
                            <div class="overlay">
                                <div class="viswrapper">
                                    <canvas id="visualiser"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="slider swiper audio-track-slider"
                        style="margin-left: 0!important; margin-right: 0!important;">
                        <div class=" swiper-wrapper">
                            <div class="swiper-slide" data-track-index="0">
                                <img src="media/img/All My Life.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">All My Life</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">The Nimmo Brothers</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="1">
                                <img src="media/img/Back For More.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Back For More</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">WT Feaster Band</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="2">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Beware</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Kyla Brox Band</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="3">
                                <img src="media/img/Blues With A Feeling.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Blues With A Feeling</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Eddie Martin Band</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="4">
                                <img src="media/img/Boogie Man.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Boogie Man</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">The Hamsters</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="5">
                                <img src="media/img/Break It Down.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Break It Down</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Normal Beaker</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="6">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Bring It On Home To Me</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Rivers</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="7">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Divin Duck</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">John O'Leary Band</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="8">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">No Time For Jive</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Lovers Lament</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="9">
                                <img src="media/img/Resting In The Blues.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Resting In The Blues</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Nicky Moore's Blues Corporation</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="10">
                                <img src="media/img/Roxette.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Roxette</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Dr. Feelgood</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="11">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Shake Your hips</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">The Backscratchers</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="12">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Stop Breakin’ Down</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">The Blue Bishops</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="13">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Sugar Man</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Connie Lush & Blues Shouter</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="14">
                                <img src="media/img/Sugar Rush.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Sugar Rush</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Ian Siegal</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="15">
                                <img src="media/img/album.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">Travellin Light</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">Blues ‘N’ Trouble</p>
                                </div> -->
                            </div>
                            <div class="swiper-slide" data-track-index="16">
                                <img src="media/img/You Gave Me The Blues.jpg">
                                <!-- <div class="overlay text-center">
                                    <p class="slider-overlay--small blue-ds">Now Playing</p>
                                    <p class="slider-overlay--main">You Gave Me The Blues</p>
                                    <p class="slider-overlay--small blue-ds">By</p>
                                    <p class="slider-overlay--main">The Mighty 45’s</p>
                                </div> -->
                            </div>
                        </div>
                        <div class="slider-buttons-wrapper">
                            <div class="swiper-button-prev">
                                <i class="fas fa-chevron-left"></i>
                            </div>
                            <div class="swiper-button-next">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
const audioSlider = new Swiper(".audio-track-slider", {
    slidesPerView: 1,
    spaceBetween: 30,
    loop: true,
    breakpoints: {
        576: {
            slidesPerView: 2,
        },
    },
    navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
    },
    // autoplay: {
    //     disableOnInteraction: true,
    //     pauseOnMouseHover: true,
    // },
    autoplay: false
});
// Audio
document.addEventListener('DOMContentLoaded', function() {
    const audioPlayer = document.getElementById("audioPlayer");
    const prevButton = document.getElementById("prevBtn");
    const playButton = document.getElementById("playBtn");
    const stopButton = document.getElementById("stopBtn");
    const nextButton = document.getElementById("nextBtn");
    const canvas = document.getElementById('visualiser');
    const canvasContext = canvas.getContext('2d');
    const visWrapper = document.querySelector('.record-player .overlay .viswrapper');
    const imageWidth = visWrapper.clientWidth;
    const imageHeight = visWrapper.clientHeight;

    const playlist = [{
            src: 'media/audio/All My Life.mp3',
            trackIndex: 0
        },
        {
            src: 'media/audio/Back for More.mp3',
            trackIndex: 1
        },
        {
            src: 'media/audio/Beware.mp3',
            trackIndex: 2
        },
        {
            src: 'media/audio/Blues With A Feeling.mp3',
            trackIndex: 3
        },
        {
            src: 'media/audio/Boogie Man.mp3',
            trackIndex: 4
        },
        {
            src: 'media/audio/Break it Down.mp3',
            trackIndex: 5
        },
        {
            src: 'media/audio/Bring It On Home To Me.mp3',
            trackIndex: 6
        },
        {
            src: 'media/audio/Divin Duck.mp3',
            trackIndex: 7
        },
        {
            src: 'media/audio/No Time for Jive.mp3',
            trackIndex: 8
        },
        {
            src: 'media/audio/Resting In The Blues.mp3',
            trackIndex: 9
        },
        {
            src: 'media/audio/Roxette.mp3',
            trackIndex: 10
        },
        {
            src: 'media/audio/Shake Your Hips.mp3',
            trackIndex: 11
        },
        {
            src: 'media/audio/Stop Breakin Down.mp3',
            trackIndex: 12
        },
        {
            src: 'media/audio/Sugar Man.mp3',
            trackIndex: 13
        },
        {
            src: 'media/audio/Sugar Rush.mp3',
            trackIndex: 14
        },
        {
            src: 'media/audio/Travellin Light.mp3',
            trackIndex: 15
        },
        {
            src: 'media/audio/You Gave Me The Blues.mp3',
            trackIndex: 16
        }
    ];

    let currentTrackIndex = 0;

    function playTrack(trackSrc) {
        audioPlayer.src = trackSrc;
        audioPlayer.play();
    }

    playButton.addEventListener('click', () => {
        if (audioPlayer.paused) {
            playTrack(playlist[currentTrackIndex].src);
        } else {
            audioPlayer.pause();
        }
    });

    nextButton.addEventListener('click', () => {
        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        playTrack(playlist[currentTrackIndex].src);
    });

    prevButton.addEventListener('click', () => {
        currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
        playTrack(playlist[currentTrackIndex].src);
    });

    stopButton.addEventListener('click', () => {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;
    });

    const albumCovers = document.querySelectorAll('.swiper-slide');
    albumCovers.forEach((cover) => {
        const trackIndex = parseInt(cover.getAttribute('data-track-index'));
        cover.addEventListener('click', () => {
            const track = playlist.find(item => item.trackIndex === trackIndex);
            if (track) {
                currentTrackIndex = trackIndex;
                playTrack(track.src);

                // Remove "playing" class from all album covers
                albumCovers.forEach((cover) => {
                    cover.classList.remove('playing');
                    // cover.querySelector('.overlay').style.display = 'none';

                });

                // Add "playing" class to the clicked album cover
                cover.classList.add('playing');
                // cover.querySelector('.overlay').style.display = 'flex';

            }
        });
    });


    // Visualiser
    if (canvas) {
        let audioContext;
        let source;
        let analyser;

        function startVisualiser() {
            audioContext = new AudioContext();
            source = audioContext.createMediaElementSource(audioPlayer);
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            source.connect(analyser);
            analyser.connect(audioContext.destination);

            drawVisualiser();

            function drawVisualiser() {
                canvas.width = imageWidth;
                canvas.height = imageHeight;

                canvasContext.clearRect(0, 0, canvas.width, canvas.height);
                analyser.getByteFrequencyData(dataArray);

                const centerX = imageWidth / 2;
                const centerY = imageHeight / 2;
                const maxRadius = Math.min(centerX, centerY) - 10;

                dataArray.forEach(value => {
                    const radius = (value / 255) * maxRadius;

                    canvasContext.beginPath();
                    canvasContext.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    canvasContext.strokeStyle = `rgba(55, ${value / 255}, 255, ${value / 255})`;
                    canvasContext.lineWidth = 2;
                    canvasContext.stroke();
                });

                requestAnimationFrame(drawVisualiser);
            }
        }

        // Call startVisualiser() when a track starts playing
        audioPlayer.addEventListener('play', startVisualiser);
    } else {
        console.error('Canvas element not found.');
    }
});
</script>